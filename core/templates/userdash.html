{% extends "base.html" %}
{% load static %}

{% block title %}User Dashboard | Vericon Constructions{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'style.css' %}">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

<style>
  .wrapper {
    display: flex;
  }

  .sidebar {
    width: 250px;
    background: linear-gradient(to bottom right, #0d1440, #2152ff);
    color: white;
    height: 100vh;
    position: fixed;
    left: 0;
    top: 0;
    padding-top: 60px;
    transition: transform 0.3s ease;
    z-index: 1000;
  }

  .sidebar.collapsed {
    transform: translateX(-100%);
  }

  .sidebar a {
    display: block;
    color: white;
    padding: 12px 20px;
    text-decoration: none;
    transition: background 0.3s;
  }

  .sidebar a:hover {
    background-color: rgba(255,255,255,0.1);
  }

  .main {
    margin-left: 250px;
    padding: 30px;
    width: 100%;
    transition: margin-left 0.3s ease;
  }

  .main.shifted {
    margin-left: 0;
  }

  #sidebarToggle {
    position: fixed;
    top: 10px;
    left: 10px;
    z-index: 1101;
    background: #0d1440;
    color: white;
    border: none;
    padding: 10px 14px;
    border-radius: 5px;
    font-size: 20px;
    cursor: pointer;
  }

  @media screen and (max-width: 768px) {
    .main {
      padding: 20px;
    }
  }
</style>
{% endblock %}

{% block content %}
<div class="wrapper">
  
  <!-- Sidebar -->
 

  <!-- Toggle Button -->
  <button id="sidebarToggle"><i class="bi bi-list"></i></button>

  <!-- Main Content -->
  <div class="main" id="mainContent">
    <div class="container-fluid mt-4">

      <!-- Welcome + About You -->
      <div class="row g-3 mb-3">
        <div class="col-md-6">
          <div class="card p-4 shadow-sm h-100">
            <h4>Welcome, {{ employee.full_name }} üë∑</h4>
            <p class="text-muted mb-0">Role: {{ user.role }}</p>
            <p class="text-muted">Assigned Site: Site A</p>
          </div>
        </div>

        <div class="col-md-6">
          <div class="card p-4 shadow-sm h-100">
            <h5 class="mb-3">About You</h5>
            <table class="table table-sm mb-0">
              <tbody>
                <tr><th>Employee ID</th><td>{{ employee.employee_id }}</td></tr>
                <tr><th>Full Name</th><td>{{ employee.full_name }}</td></tr>
                <tr><th>Email</th><td>{{ employee.email }}</td></tr>
                <tr><th>Phone</th><td>{{ employee.phone }}</td></tr>
                <tr><th>Joining Date</th><td>{{ employee.joined_on }}</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Alerts -->
      {% if messages %}
      <div class="row mb-3">
        <div class="col">
          {% for message in messages %}
            <div class="alert alert-{{ message.tags }}">{{ message }}</div>
          {% endfor %}
        </div>
      </div>
      {% endif %}

      <!-- Attendance Stats -->
      <div class="row g-3 mb-3">
        <div class="col-md-4">
          <div class="card text-white bg-success p-3 shadow-sm">
            <h5>{{ attendance_present }}/{{ attendance_total }}</h5>
            <p>Present Days</p>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card text-white bg-danger p-3 shadow-sm">
            <h5>{{ absent_days }}</h5>
            <p>Absent Days</p>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card text-white bg-info p-3 shadow-sm">
            <h5>{{ attendance_percent }}%</h5>
            <p>Attendance Rate</p>
          </div>
        </div>
      </div>

      <!-- Reports & Analytics -->
      <div class="row mb-3">
        <div class="col">
          <div class="card p-3 shadow-sm">
            <h5 class="mb-3">Reports & Analytics</h5>
            <ul class="list-group list-group-flush">
              {% for report in reports %}
                <li class="list-group-item">
                  <strong>{{ report.title }}</strong><br>
                  <small class="text-muted">{{ report.created_at|date:"M d, Y H:i" }}</small>
                  <p class="mb-1 text-muted">{{ report.description|truncatewords:15 }}</p>
                </li>
              {% empty %}
                <li class="list-group-item text-muted">No reports submitted yet.</li>
              {% endfor %}
            </ul>
          </div>
        </div>
      </div>

      <!-- Quick Actions + Notifications -->
      <div class="row g-3 mb-3">
        <div class="col-md-6">
          <div class="card p-3 shadow-sm">
            <h5>Quick Actions</h5>
            <div class="d-grid gap-2 mt-3">
              <a href="{% url 'attendance' %}" class="btn btn-success">‚úîÔ∏è Mark Attendance</a>
              <a href="{% url 'payroll' %}" class="btn btn-primary">üìù Payroll</a>
            </div>
          </div>
        </div>

        <div class="col-md-6">
          <div class="card p-3 shadow-sm">
            <h5>Notifications</h5>
            <ul class="list-group list-group-flush mt-2">
              {% for note in notifications %}
                <li class="list-group-item">{{ note.message }}</li>
              {% empty %}
                <li class="list-group-item">üîß Site A will undergo maintenance on July 25, 2025.</li>
                <li class="list-group-item">üìÑ Your last attendance was marked on July 21, 2025.</li>
                <li class="list-group-item">üì¢ New safety protocols have been updated. Please review them.</li>
                <li class="list-group-item">üí∞ Payroll for July will be processed on July 28, 2025.</li>
                <li class="list-group-item">üìù Submit your daily progress report before 6 PM today.</li>
              {% endfor %}
            </ul>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>

<!-- Sidebar toggle script -->
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const toggleButton = document.getElementById('sidebarToggle');
    const sidebar = document.getElementById('sidebar');
    const main = document.getElementById('mainContent');

    toggleButton.addEventListener('click', () => {
      sidebar.classList.toggle('collapsed');
      main.classList.toggle('shifted');
    });
  });
</script>
{% endblock %}
