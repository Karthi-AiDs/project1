{% extends 'base.html' %}
{% load static %}

{% block title %}Vendor Management{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/style.css' %}">
<link href="https://fonts.googleapis.com/css2?family=Lato&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&family=Orbitron:wght@700&display=swap" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
<style>
  .hover-card {
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    cursor: pointer;
  }
  .hover-card:hover {
    transform: scale(1.02);
    box-shadow: 0 0.5rem 1rem rgba(0, 128, 0, 0.15);
    border-color: #198754;
  }
  .back-btn {
    margin: 1rem;
    padding: 0.5rem 1rem;
    background-color: #0d6efd;
    color: white;
    border: none;
    border-radius: 0.375rem;
    font-weight: 500;
    cursor: pointer;
  }
  .back-btn:hover {
    background-color: #0b5ed7;
  }
</style>
{% endblock %}

{% block back_button %}
  <button class="back-btn" onclick="history.back()">‚Üê Back</button>
{% endblock %}

{% block content %}
<div class="container py-5">
  <div class="header text-center mb-4">
    <h2 class="fw-bold">Vendor Management</h2>
    <p class="text-muted">Vendor Portal - Transactions & Services</p>
  </div>

  <!-- Navigation Tabs -->
  <div class="d-flex justify-content-center flex-wrap gap-2 mb-4">
    <button class="btn btn-outline-warning active" onclick="showSection('profiles')"><i class="bi bi-person-lines-fill"></i> Vendor Profiles</button>
    <button class="btn btn-outline-secondary" onclick="showSection('transactions')"><i class="bi bi-cash-stack"></i> Transactions</button>
    <button class="btn btn-outline-secondary" onclick="showSection('service')"><i class="bi bi-clock-history"></i> Service History</button>
    <button class="btn btn-outline-secondary" onclick="showSection('payment')"><i class="bi bi-currency-rupee"></i> Payment Status</button>
  </div>

  <!-- SECTION: Vendor Profiles -->
  <div id="section-profiles">
    <h4 class="mb-3">üè¢ Vendor Profiles</h4>
    <div class="row row-cols-1 row-cols-md-3 g-4">
      {% for vendor in vendors %}
        <div class="col">
          <div class="border rounded p-3 bg-light hover-card">
            <h5 class="text-success"><i class="bi bi-person-badge-fill"></i> {{ vendor.name }}</h5>
            <p class="text-muted">Contact: {{ vendor.contact_person }}</p>
            <p><i class="bi bi-geo-alt-fill"></i> {{ vendor.address }}</p>
            <p><i class="bi bi-telephone-fill"></i> {{ vendor.phone }}</p>
            <p><i class="bi bi-envelope-fill"></i> {{ vendor.email }}</p>
            {% if vendor.gps_location %}
              <p><i class="bi bi-geo"></i> GPS: {{ vendor.gps_location }}</p>
            {% endif %}
            {% if vendor.approved_by %}
              <p><i class="bi bi-person-check-fill"></i> Approved By: {{ vendor.approved_by }}</p>
            {% endif %}
          </div>
        </div>
      {% empty %}
        <p class="text-muted">No vendors found.</p>
      {% endfor %}
    </div>
  </div>

  <!-- SECTION: Transactions -->
  <div id="section-transactions" class="d-none">
    <h4 class="mb-4">üí∞ Transactions</h4>
    <div class="table-responsive">
      <table class="table table-bordered table-hover shadow-sm rounded">
        <thead class="table-dark">
          <tr>
            <th>Transaction ID</th>
            <th>Vendor</th>
            <th>Date</th>
            <th>Amount (‚Çπ)</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
          <tr><td>TXN-00124</td><td>Raj Equipments</td><td>14-07-2025</td><td>65,000</td><td><span class="badge bg-success">Paid</span></td></tr>
          <tr><td>TXN-00125</td><td>GreenTech Services</td><td>15-07-2025</td><td>40,000</td><td><span class="badge bg-warning text-dark">Pending</span></td></tr>
          <tr><td>TXN-00126</td><td>Max Constructions</td><td>18-07-2025</td><td>80,000</td><td><span class="badge bg-danger">Overdue</span></td></tr>
          <tr><td>TXN-00127</td><td>SkyLift Rentals</td><td>21-07-2025</td><td>55,000</td><td><span class="badge bg-success">Paid</span></td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- SECTION: Service History -->
  <div id="section-service" class="d-none">
    <h4 class="mb-4">üîß Service History</h4>
    <div class="table-responsive">
      <table class="table table-bordered table-hover shadow-sm rounded">
        <thead class="table-dark">
          <tr>
            <th>Equipment</th>
            <th>Service Type</th>
            <th>Date</th>
            <th>Cost (‚Çπ)</th>
            <th>Remarks</th>
          </tr>
        </thead>
        <tbody>
          <tr><td>Excavator #112</td><td>Engine Repair</td><td>12-07-2025</td><td>15,000</td><td>Oil leakage fixed</td></tr>
          <tr><td>Bulldozer #207</td><td>Track Adjustment</td><td>09-07-2025</td><td>8,000</td><td>Left side track realigned</td></tr>
          <tr><td>Crane #503</td><td>Hydraulic Fluid Change</td><td>02-07-2025</td><td>5,500</td><td>Routine service</td></tr>
          <tr><td>Sand Transporter</td><td>Tyre Replacement</td><td>17-07-2025</td><td>7,000</td><td>Rear tyre burst</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- SECTION: Payment Status -->
  <div id="section-payment" class="d-none">
    <h4 class="mb-4">üí≥ Payment Status</h4>
    <div class="row text-center mb-4">
      <div class="col-md-3">
        <div class="border rounded p-3 bg-light">
          <div class="h4">‚Çπ 150000</div>
          <small>Total Outstanding</small>
        </div>
      </div>
      <div class="col-md-3">
        <div class="border rounded p-3 bg-light">
          <div class="h4">‚Çπ 87500</div>
          <small>This Month</small>
        </div>
      </div>
      <div class="col-md-3">
        <div class="border rounded p-3 bg-light">
          <div class="h4">‚Çπ 325000</div>
          <small>Overdue</small>
        </div>
      </div>
      <div class="col-md-3">
        <div class="border rounded p-3 bg-light">
          <div class="h4">3</div>
          <small>Active Vendors</small>
        </div>
      </div>
    </div>
  </div>

  <!-- Access Control -->
  <div class="mb-5 mt-4">
    <div class="accordion" id="accessAccordion">
      <div class="accordion-item border border-success shadow-sm">
        <h2 class="accordion-header" id="headingAccess">
          <button class="accordion-button bg-success text-white fw-bold" type="button" data-bs-toggle="collapse" data-bs-target="#collapseAccess" aria-expanded="true" aria-controls="collapseAccess">
            <i class="bi bi-shield-lock-fill me-2"></i> Access Control & Permissions
          </button>
        </h2>
        <div id="collapseAccess" class="accordion-collapse collapse show" aria-labelledby="headingAccess" data-bs-parent="#accessAccordion">
          <div class="accordion-body bg-light">
            <ul class="list-group list-group-flush">
              <li class="list-group-item bg-transparent border-0"><i class="bi bi-check-circle-fill text-success me-2"></i> Vendors can only view their own transaction history</li>
              <li class="list-group-item bg-transparent border-0"><i class="bi bi-check-circle-fill text-success me-2"></i> Equipment details limited to vendor's registered vehicles</li>
              <li class="list-group-item bg-transparent border-0"><i class="bi bi-check-circle-fill text-success me-2"></i> GPS tracking only for vendor's own equipment</li>
              <li class="list-group-item bg-transparent border-0"><i class="bi bi-check-circle-fill text-success me-2"></i> Service history restricted to vendor's maintenance records</li>
              <li class="list-group-item bg-transparent border-0"><i class="bi bi-check-circle-fill text-success me-2"></i> Payment status visible only for vendor's pending amounts</li>
              <li class="list-group-item bg-transparent border-0"><i class="bi bi-x-circle-fill text-danger me-2"></i> No access to other vendors' financial information</li>
              <li class="list-group-item bg-transparent border-0"><i class="bi bi-x-circle-fill text-danger me-2"></i> Cannot view competitor equipment or locations</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
  function showSection(key) {
    const sections = ['profiles', 'transactions', 'equipment', 'service', 'payment'];
    sections.forEach(sec => {
      const el = document.getElementById('section-' + sec);
      if (el) el.classList.add('d-none');
    });
    const showEl = document.getElementById('section-' + key);
    if (showEl) showEl.classList.remove('d-none');

    document.querySelectorAll('.btn-outline-warning, .btn-outline-secondary').forEach(btn => {
      btn.classList.remove('active');
    });
    event.target.classList.add('active');
  }
</script>
{% endblock %}